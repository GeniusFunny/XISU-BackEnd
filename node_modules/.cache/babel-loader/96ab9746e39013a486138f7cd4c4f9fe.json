{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _setImmediate from \"@babel/runtime-corejs2/core-js/set-immediate\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nvar superAgent = require('superagent');\n\nvar cheerio = require('cheerio');\n\nvar fetchClassroom = require('./API_URL').fetchClassroom;\n\nvar cookieDao = require('./CookieDao').CookieDao;\n\nvar write = require('../cache/index').write;\n\nfunction ClassroomDao(_x, _x2, _x3) {\n  return _ClassroomDao.apply(this, arguments);\n}\n\nfunction _ClassroomDao() {\n  _ClassroomDao = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(query, userId, cookie) {\n    var field;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            field = \"\".concat(query.cycleTime.dateBegin, \" \").concat(query.timeBegin, \"-\").concat(query.timeEnd);\n\n            if (!(typeof cookie === 'undefined')) {\n              _context2.next = 6;\n              break;\n            }\n\n            _context2.next = 4;\n            return cookieDao(userId);\n\n          case 4:\n            cookie = _context2.sent;\n            cookie = cookie[0].cookie;\n\n          case 6:\n            _context2.next = 8;\n            return superAgent.post(fetchClassroom).set('Cookie', cookie).send(\"classroom.type.id=&classroom.campus.id=&classroom.building.id=&seats=&classroom.name=&cycleTime.cycleCount=1&cycleTime.cycleType=1&cycleTime.dateBegin=\".concat(query.cycleTime.dateBegin, \"&cycleTime.dateEnd=\").concat(query.cycleTime.dateEnd, \"&roomApplyTimeType=1&timeBegin=\").concat(query.timeBegin, \"&timeEnd=\").concat(query.timeEnd)).then(function (res) {\n              var $ = cheerio.load(res.text);\n              var emptyClassroom = [];\n\n              try {\n                $('tbody').children('tr').each(function (i, elem) {\n                  emptyClassroom[i] = {\n                    date: query.cycleTime.dateBegin,\n                    time: \"\".concat(query.timeBegin, \"~\").concat(query.timeEnd),\n                    roomName: $(elem).children()[1].firstChild.data.replace(/[\\r\\n\\t]/g, ''),\n                    location: $(elem).children()[2].firstChild.data.replace(/[\\r\\n\\t]/g, ''),\n                    type: $(elem).children()[4].firstChild.data.replace(/[\\r\\n\\t]/g, ''),\n                    size: _parseInt($(elem).children()[5].firstChild.data.replace(/[\\r\\n\\t]/g, ''))\n                  };\n                });\n\n                _setImmediate(\n                /*#__PURE__*/\n                _asyncToGenerator(\n                /*#__PURE__*/\n                _regeneratorRuntime.mark(function _callee() {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.next = 2;\n                          return write('emptyClassroom', field, _JSON$stringify(emptyClassroom));\n\n                        case 2:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                })));\n\n                return emptyClassroom;\n              } catch (e) {\n                throw new Error(e);\n              }\n            });\n\n          case 8:\n            return _context2.abrupt(\"return\", _context2.sent);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _ClassroomDao.apply(this, arguments);\n}\n\nexports.ClassroomDao = ClassroomDao;","map":null,"metadata":{},"sourceType":"module"}